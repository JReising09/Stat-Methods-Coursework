my.datafile <- tempfile()
cat(file=my.datafile, "
    Taste Acetic H2S Lactic
    22.7 5.46 4.17 1.59
    53.3 6.52 10.17 1.96
    20.1 5.35 4.9 1.43
    24.6 5.33 4.46 1.36
    20.2 5.33 5.03 1.19
    24.4 5.43 4.18 1.6
    31.8 5.82 6.69 1.71
    30.3 5.43 5.84 1.55
    39.2 5.82 7.65 1.76
    27.4 5.56 6.21 1.49
    8.1 5.54 4.85 1.45
    37.2 5.53 5.9 1.61
    5.6 4.98 4.72 1.25
    20.4 5.5 4.12 1.66
    33.4 5.73 7.36 1.65
    21.3 5.42 5.12 1.51
    18.8 5.2 5.06 1.15
    17.2 5.07 4.46 1.28
    30.6 5.48 6.07 1.56
    26.9 5.85 6.58 1.66
    22.6 5.25 3.42 1.36
    34 5.92 7.73 1.74
    22 5.57 7.45 1.34
    55.4 6.33 10.3 1.96
    6.1 4.8 4.25 0.88
    15.6 5.09 5.07 1.1
    29.8 5.66 7.08 1.5
    16.8 5.42 5.11 1.51
    17 5.37 5.83 1.3
    25.8 5.46 6.55 1.31
    ", sep=" ")

train<- read.table(my.datafile, header=T) 


test.fit<-lm(Taste ~ Acetic +H2S + Lactic, data=train)

summary(test.fit)
#Note we could drop Acetic based on the p-value

test.fit.red<-lm(Taste~ H2S + Lactic, data = train)

my.datafile <- tempfile()
cat(file=my.datafile, "
    Taste Acetic H2S Lactic
    47.5 6.41 7.64 2.14
    42.1 6.41 9.25 2.05
    12.1 5.2 4.44 1.14
    47.2 6.21 9.76 1.81
    51.1 6.36 10.86 1.63
    16.4 5.19 6.19 1.08
    34.8 5.97 6.16 2
    23.9 5.09 5.63 0.99
    10.3 4.95 3.41 1.11
    49.1 5.85 7.58 1.62
    38.1 5.89 8.4 1.59
    36.6 5.68 7.48 1.59
    38.8 5.92 7.58 1.71
    0.8 4.79 2.83 1.06
    40.7 5.8 6.81 1.84
    10.6 4.95 3.67 1.03
    9.2 4.83 3.8 0.99
    23.1 5.59 5.62 1.57
    20.9 5.67 4.51 1.76
    54.2 6.05 8.96 1.83
    27 5.1 4.94 1.17
    10.9 5.05 4.29 1.1
    6.7 4.27 2.88 0.67
    30.1 5.59 6.41 1.59
    30 5.81 9.09 1.43
    21.7 5.45 5.11 1.43
    0.1 4.22 2.22 0.5
    36.4 5.94 5.18 1.93
    28.8 5.28 5.36 1.37
    41.9 5.87 7.71 1.71
    ", sep=" ")

validation <- read.table(my.datafile, header=T) 



#Predictions for Validation data using the Training data

pred.val<-predict(object = test.fit, newdata = validation)

pred.val.red<-predict(object = test.fit.red, newdata = validation)

nstar<-dim(validation)[1]

mspr<-sum((validation$Taste - pred.val)^2)/nstar

mspr

anova(test.fit)

mspr/27.38

#####################
mspr.red<-sum((validation$Taste - pred.val.red)^2)/nstar

mspr.red

anova(test.fit.red)

mspr.red/26.37

#Both are fairly close to each other and close to one but there may be a little 
# overfitting here

# Also note that we did not check any assumptions which may have an impact...


############################################################################
# Prediction Sum of Squares - MODEL VALIDATION
############################################################################
my.datafile <- tempfile()
cat(file=my.datafile, "
    6.7 62 81 2.59 50 0 1 0 695 6.544
    5.1 59 66 1.70 39 0 0 0 403 5.999
    7.4 57 83 2.16 55 0 0 0 710 6.565
    6.5 73 41 2.01 48 0 0 0 349 5.854
    7.8 65 115 4.30 45 0 0 1 2343 7.759
    5.8 38 72 1.42 65 1 1 0 348 5.852
    5.7 46 63 1.91 49 1 0 1 518 6.250
    3.7 68 81 2.57 69 1 1 0 749 6.619
    6.0 67 93 2.50 58 0 1 0 1056 6.962
    3.7 76 94 2.40 48 0 1 0 968 6.875
    6.3 84 83 4.13 37 0 1 0 745 6.613
    6.7 51 43 1.86 57 0 1 0 257 5.549
    5.8 96 114 3.95 63 1 0 0 1573 7.361
    5.8 83 88 3.95 52 1 0 0 858 6.754
    7.7 62 67 3.40 58 0 0 1 702 6.554
    7.4 74 68 2.40 64 1 1 0 809 6.695
    6.0 85 28 2.98 36 1 1 0 682 6.526
    3.7 51 41 1.55 39 0 0 0 205 5.321
    7.3 68 74 3.56 59 1 0 0 550 6.309
    5.6 57 87 3.02 63 0 0 1 838 6.731
    5.2 52 76 2.85 39 0 0 0 359 5.883
    3.4 83 53 1.12 67 1 1 0 353 5.866
    6.7 26 68 2.10 30 0 0 1 599 6.395
    5.8 67 86 3.40 49 1 1 0 562 6.332
    6.3 59 100 2.95 36 1 1 0 651 6.478
    5.8 61 73 3.50 62 1 1 0 751 6.621
    5.2 52 86 2.45 70 0 1 0 545 6.302
    11.2 76 90 5.59 58 1 0 1 1965 7.583
    5.2 54 56 2.71 44 1 0 0 477 6.167
    5.8 76 59 2.58 61 1 1 0 600 6.396
    3.2 64 65 0.74 53 0 1 0 443 6.094
    8.7 45 23 2.52 68 0 1 0 181 5.198
    5.0 59 73 3.50 57 0 1 0 411 6.019
    5.8 72 93 3.30 39 1 0 1 1037 6.944
    5.4 58 70 2.64 31 1 1 0 482 6.179
    5.3 51 99 2.60 48 0 1 0 634 6.453
    2.6 74 86 2.05 45 0 0 0 678 6.519
    4.3 8 119 2.85 65 1 0 0 362 5.893
    4.8 61 76 2.45 51 1 1 0 637 6.457
    5.4 52 88 1.81 40 1 0 0 705 6.558
    5.2 49 72 1.84 46 0 0 0 536 6.283
    3.6 28 99 1.30 55 0 0 1 582 6.366
    8.8 86 88 6.40 30 1 1 0 1270 7.147
    6.5 56 77 2.85 41 0 1 0 538 6.288
    3.4 77 93 1.48 69 0 1 0 482 6.178
    6.5 40 84 3.00 54 1 1 0 611 6.416
    4.5 73 106 3.05 47 1 1 0 960 6.867
    4.8 86 101 4.10 35 1 0 1 1300 7.170
    5.1 67 77 2.86 66 1 0 0 581 6.365
    3.9 82 103 4.55 50 0 1 0 1078 6.983
    6.6 77 46 1.95 50 0 1 0 405 6.005
    6.4 85 40 1.21 58 0 0 1 579 6.361
    6.4 59 85 2.33 63 0 1 0 550 6.310
    8.8 78 72 3.20 56 0 0 0 651 6.478
    ", sep=" ")
options(scipen=999) # suppressing scientific notation


surg.data <- read.table(file = my.datafile, 
                        header=FALSE, col.names = c('x1', 'x2', 'x3', 'x4', 'x5', 'x6', 'x7', 'x8', 'y', 'lny'))

# attaching the data frame:

attach(surg.data)

surg.fit<-lm(y~x1+x2+x3+x8)

PRESS.statistic <- sum( (resid(surg.fit)/(1-hatvalues(surg.fit)))^2 )
print(paste("PRESS statistic= ", PRESS.statistic))

# Compare this to SSE
anova(surg.fit)

2555454/1913636 #PRESS/SSE

